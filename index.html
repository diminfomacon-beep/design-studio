<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>D.I.M. Bright Ideas – Design Studio</title>

<!-- Fabric.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f4f4f4;
}
header{
    background:#0C264D;
    color:white;
    padding:15px;
    text-align:center;
    font-size:20px;
}
.container{
    display:flex;
    flex-wrap:wrap;
}
.controls{
    width:300px;
    background:white;
    padding:15px;
    box-shadow:0 0 10px rgba(0,0,0,.1);
}
.controls h3{
    margin-top:0;
}
.controls input, .controls select{
    width:100%;
    padding:8px;
    margin-bottom:10px;
}
.controls button{
    width:100%;
    padding:10px;
    margin-bottom:8px;
    border:none;
    cursor:pointer;
    border-radius:4px;
    background:#044499;
    color:white;
}
.controls button.red{ background:#ED7800;}
.controls button.green{ background:#28a745;}

.canvas-area{
    flex:1;
    text-align:center;
    padding:20px;
}
#canvas-wrap{
    background:white;
    border:3px solid #333;
    display:inline-block;
}
</style>
</head>

<body>

<header>
D.I.M. Bright Ideas – Custom Print Studio
</header>

<div class="container">

<div class="controls">

<h3>Add Text</h3>
<input type="text" id="textInput" placeholder="Enter text">
<select id="fontSelect">
<option value="Arial">Arial</option>
<option value="Impact">Impact</option>
<option value="Times New Roman">Times New Roman</option>
<option value="Courier New">Courier New</option>
</select>
<input type="number" id="fontSize" value="40">
<input type="color" id="fontColor" value="#000000">
<button onclick="addText()">Add Text</button>

<h3>Upload Logo</h3>
<input type="file" id="upload" accept="image/*">
<h3>Search Graphics</h3>
<input type="text" id="imageQuery" placeholder="Search images...">
<select id="imageSource">
  <option value="unsplash">Unsplash</option>
  <option value="pexels">Pexels</option>
</select>
<button onclick="searchImages()">Search</button>

<div id="imageResults" style="display:flex;flex-wrap:wrap;gap:5px;max-height:200px;overflow:auto;"></div>
<h3>Layers</h3>
<button onclick="bringForward()">Bring Forward</button>
<button onclick="sendBackward()">Send Backward</button>

<h3>Canvas</h3>
<input type="color" id="bgColor" value="#ffffff">
<button onclick="changeBackground()">Change Background</button>

<button class="red" onclick="deleteObj()">Delete Selected</button>
<button class="green" onclick="download()">Download Design</button>

</div>

<div class="canvas-area">
<div id="canvas-wrap">
<canvas id="studio" width="600" height="600"></canvas>
</div>
</div>

</div>

<script>

let canvas = new fabric.Canvas('studio',{
    preserveObjectStacking:true
});

// Add Text
function addText(){
    const text = new fabric.IText(
        document.getElementById('textInput').value || "Your Text",
        {
            left:100,
            top:100,
            fontFamily:document.getElementById('fontSelect').value,
            fill:document.getElementById('fontColor').value,
            fontSize:parseInt(document.getElementById('fontSize').value)
        }
    );
    canvas.add(text);
}

// Upload Image
document.getElementById('upload').addEventListener('change',function(e){
    const reader = new FileReader();
    reader.onload = function(f){
        fabric.Image.fromURL(f.target.result,function(img){
            img.scaleToWidth(250);
            canvas.add(img);
        });
    };
    reader.readAsDataURL(e.target.files[0]);
});

// Delete
function deleteObj(){
    canvas.getActiveObjects().forEach(obj => canvas.remove(obj));
    canvas.discardActiveObject();
    canvas.renderAll();
}

// Layer Controls
function bringForward(){
    const obj = canvas.getActiveObject();
    if(obj) canvas.bringForward(obj);
}
function sendBackward(){
    const obj = canvas.getActiveObject();
    if(obj) canvas.sendBackwards(obj);
}

// Background Color
function changeBackground(){
    canvas.setBackgroundColor(
        document.getElementById('bgColor').value,
        canvas.renderAll.bind(canvas)
    );
}

// Download
function download(){
    canvas.discardActiveObject();
    canvas.renderAll();
    const link = document.createElement('a');
    link.download = 'DIM_Design.png';
    link.href = canvas.toDataURL({
        format:'png',
        multiplier:3
    });
    link.click();
}
const UNSPLASH_KEY = "Z-a_ubE9NWNeF8tLL7QM4LjHdrIW7_RE0ZHUWAUi_zU";
const PEXELS_KEY = "P8Cir7evpy7BpcaUKsQJSxaNXmo9jz1XriQ3TqiHrwMYDRpiKxNlxe8c";

async function searchImages() {
    const query = document.getElementById("imageQuery").value;
    const source = document.getElementById("imageSource").value;
    const resultsDiv = document.getElementById("imageResults");
    resultsDiv.innerHTML = "Loading...";

    try {
        let images = [];

        if (source === "unsplash") {
            const url = `https://api.unsplash.com/search/photos?query=${query}&per_page=12&client_id=${UNSPLASH_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            images = data.results.map(p => p.urls.small);
        }

        if (source === "pexels") {
            const url = `https://api.pexels.com/v1/search?query=${query}&per_page=12`;
            const res = await fetch(url, {
                headers: { Authorization: PEXELS_KEY }
            });
            const data = await res.json();
            images = data.photos.map(p => p.src.medium);
        }

        resultsDiv.innerHTML = "";

        images.forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.style.width = "60px";
            img.style.cursor = "pointer";

            img.onclick = () => {
                fabric.Image.fromURL(url, function(fImg) {
                    fImg.scaleToWidth(200);
                    canvas.add(fImg);
                    canvas.renderAll();
                }, { crossOrigin: 'anonymous' });
            };

            resultsDiv.appendChild(img);
        });

    } catch (error) {
        console.error(error);
        resultsDiv.innerHTML = "Error loading images";
    }
}

</script>

</body>
</html>
